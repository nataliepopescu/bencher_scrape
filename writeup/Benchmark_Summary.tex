\documentclass{article}

%\usepackage[normalem]{ulem}
\usepackage[margin=1in]{geometry}
\usepackage{longtable}
\usepackage[tableposition=below]{caption}
\captionsetup[longtable]{skip=1em}

\begin{document}

\title{Summary of Benchmark Results}
\date{}
\author{Natalie Popescu}
\maketitle


\begin{description}

\item[VANILLA] Unmodified Rustc

\item[NOBC] Rustc modified to \textit{not} insert slice bounds checks

\item[SAFELIB] Rustc modified with a safe implementation of \texttt{memcpy}

\item[NOBC+SL] Rustc with both of the above modifications

\end{description}


\section{Expectations}


\begin{enumerate}

\item \textbf{NOBC} performs at least as well as \textbf{VANILLA}

\item \textbf{LTO=thin} performs at least as well as \textbf{LTO=off} (assuming it exposes more optimization opportunities)

\item \textbf{VANILLA} performs at least as well as \textbf{SAFELIB}  (due to \textbf{SAFELIB}'s hacky implementation)

\end{enumerate}


\section{Observations}


Tables~\ref{table:formatting} and~\ref{table:formatting2} provide an overview of how well the empirical performances of our modifications match up with our expectations. 
%
After compiling each crates' built-in benchmarks with each Rustc variation, we run each compiled benchmark at least 32 times (in random order) on one of two types of hardware (see Section 2.1). 
%
Table~\ref{table:formatting} focuses on expectations \#1 and \#3 with \textbf{LTO=off} and \textbf{LTO=thin}, while Table~\ref{table:formatting2} focuses on how each Rustc version matches up with expectation \#2. % across crates.
%
See Section 2.2 for more details about what these values mean. 
%Note that \textbf{LTO=thin} means the crates were compiled with the "-C embed-bitcode=yes" flag, which was omitted in \textbf{LTO=no}.
%
Later figures attempt to quantify the unexpected performance differences per crate that we initially summarize. 


\subsection{Cloudlab Machines}
\bigskip

\textbf{Wisconsin Cluster: c220g2}

\begin{description}
\item[CPU] Two Intel E5-2660 v3 10-core CPUs at 2.60 GHz (Haswell EP)
\item[RAM] 160GB ECC Memory (10x 16 GB DDR4 2133 MHz dual rank RDIMMs)
\item[Disk] One Intel DC S3500 480 GB 6G SATA SSDs
\item[Disk] Two 1.2 TB 10K RPM 6G SAS SFF HDDs
\item[NIC] Dual-port Intel X520 10Gb NIC (PCIe v3.0, 8 lanes)
\item[NIC] Onboard Intel i350 1Gb.
\end{description}
\bigskip

\noindent\textbf{Wisconsin Cluster: c220g5}

\begin{description}
\item[CPU] Two Intel Xeon Silver 4114 10-core CPUs at 2.20 GHz
\item[RAM] 192GB ECC DDR4-2666 Memory
\item[Disk] One 1 TB 7200 RPM 6G SAS HDs
\item[Disk] One Intel DC S3500 480 GB 6G SATA SSD
\item[NIC] Dual-port Intel X520-DA2 10Gb NIC (PCIe v3.0, 8 lanes)
\item[NIC] Onboard Intel i350 1Gb
\end{description}

\subsection{Embedding Bitcode and LTO}

In evaluating any performance impact that Link Time Optimizations (LTO) have on our above modifications, we hope to better understand the directions we should further explore when developing an effective transformation pass. 
%
LLVM's optimization passes generally run on individual modules, but LTOs have the advantage of analyzing whole programs as a single executable, enabling program-wide optimizations. 
%

Here we clarify the purpose and intended behavior of two LTO-related flags we pass to Rustc: the first is the "-C embed-bitcode" flag which takes a boolean "yes" or "no" value. 
%
A value of "yes" causes Rustc to embed the generated LLVM bitcode into object files, which is necessary for LTO.
%
A value of "no" is preferable if you will not perform LTO due to smaller generated file sizes and faster compilation times. 

The value of the "-C embed-bitcode" flag implicitly sets the default value of the "-C LTO" flag. % can be overridden if needed. 
%
Specifying "-C embed-bitcode=no" implies a default of "-C LTO=off", and cannot be used with any other LTO value. % unless another value is explicitly used. 
%
Similarly, specifying "-C embed-bitcode=yes" implies a default of "-C LTO=thin", with some exceptions.
%
When bitcode is embedded, it is also possible to specify a value of "-C LTO=fat". 
%
The high-level difference between \textbf{LTO=thin} and \textbf{LTO=fat} is that \textbf{LTO=thin} tries to achieve an \textbf{LTO=fat}-level of performance gains with compile times closer to that of \textbf{LTO=off}. 
%
All of these defaults can, of course, be passed explicitly: we do this to avoid any confusion. 

\subsection{Results}
\medskip

\begin{longtable}[h!]{|l|c|c|c|c|}
    \hline
    \textbf{Crate} & \textbf{\#1 [LTO=off]} & \textbf{\#1 [LTO=thin]} & \textbf{\#3 [LTO=off]} & \textbf{\#3 [LTO=thin]}\\
    \hline
    \hline
    KDFs & X & $66.\overline{6}\%$ & X & $33.\overline{3}\%$ \\ % total = 3
    \hline
    PAKEs & $50\%$ & X & X & - \\ % total = 2
    \hline
    RustQIP & $45\%$ & $65\%$ & $45\%$ & $55\%$ \\ % total = 20
    \hline
    arrayvec & $63.\overline{63}\%$ & $36.\overline{36}\%$ & $45.\overline{45}\%$ & $72.\overline{72}\%$ \\ % total = 11
    \hline
    average & $50\%$ & $66.\overline{6}\%$ & $33.\overline{3}\%$ & $16.\overline{6}\%$ \\ % total = 6
    \hline
    base-x-rs & $50\%$ & $66.\overline{6}\%$ & $66.\overline{6}\%$ & $16.\overline{6}\%$ \\ % total = 6
    \hline
    bayesic\_rs & $33.\overline{3}\%$ & $66.\overline{6}\%$ & X & $66.\overline{6}\%$ \\ % total = 6
    \hline
    bdays & $33.\overline{3}\%$ & X & X & $33.\overline{3}\%$ \\ % total = 3
    \hline
    boyer-moore-magiclen & $66.\overline{6}\%$ & $45.8\overline{3}\%$ & $50\%$ & $66.\overline{6}\%$ \\ % total = 24
    \hline
    bravery\_router & $88.\overline{8}\%$ & $44.\overline{4}\%$ & X & $77.\overline{7}\%$ \\ % total = 9
    \hline
    bucket\_queue & X & $60\%$ & $50\%$ & $80\%$ \\ % total = 10
    \hline
    chess\_perft & $72.\overline{2}\%$ & $27.\overline{7}\%$ & $72.\overline{2}\%$ & $31.48\%$ \\ % total = 54
    \hline
    coinaddress & - & - & X & X \\ % total = 1
    \hline
    color-thief-rs & X & $50\%$ & X & $50\%$ \\ % total = 2
    \hline
    crc-any & $60\%$ & $30\%$ & $40\%$ & $80\%$ \\ % total = 10
     \hline
    directories-rs & - & - & X & $50\%$ \\ % total = 4
    \hline
    exrs & $61.54\%$ & $7.69\%$ & X & $76.92\%$ \\ % total = 13
    \hline
    fair-baccarat & - & - & X & X \\ % total = 1
    \hline
    fbleau & - & - & X & $50\%$ \\ % total = 2
    \hline
    flatten-overlapping... & X & X & X & - \\ % total = 1
    \hline
    frappe & $30\%$ & $40\%$ & $80\%$ & $60\%$ \\ % total = 10
     \hline
    gift & X & - & - & X \\ % total = 1
    \hline
    horned-owl & $75\%$ & $25\%$ & X & $50\%$ \\ % total = 4
    \hline
    implicit3d & $18.75\%$ & $56.25\%$ & $75\%$ & $50\%$ \\ % total = 16 
    \hline
    ixlist & $57.14\%$ & $57.14\%$ & $28.57\%$ & $42.86\%$ \\ % total = 7
    \hline
    lazy-static-include & $22.\overline{2}\%$ & $33.\overline{3}\%$ & $55.\overline{5}\%$ & $66.\overline{6}\%$ \\ % total = 9
    \hline
    lebe & $30\%$ & $70\%$ & X & $40\%$ \\ % total = 10
     \hline
    lehmer & $60\%$ & $20\%$ & $60\%$ & $80\%$ \\ % total = 5
    \hline
    matrixmultiply & $40.63\%$ & $37.5\%$ & X & $21.88\%$ \\ % total = 32
    \hline
    metric & $75\%$ & X & X & $25\%$ \\ % total = 4
    \hline
    nblast-rs & $88.\overline{8}\%$ & $11.\overline{1}\%$ & X & $44.\overline{4}\%$ \\ % total = 9
    \hline
    optional & $41.05\%$ & $31.58\%$ & $57.89\%$ & $72.63\%$ \\ % total = 95
    \hline
    outils & $83.\overline{3}\%$ & $50\%$ & X & $83.\overline{3}\%$ \\ % total = 12
     \hline
    partition & $70\%$ & $40\%$ & $70\%$ & $63.\overline{3}\%$ \\ % total = 30
    \hline
    ripb & $35\%$ & $10\%$ & $90\%$ & $60\%$ \\ % total = 20
    \hline
    ropey & $55.84\%$ & $76.62\%$ & $90.\overline{90}\%$ & $31.17\%$ \\ % total = 77
    \hline
    rtriangulate & X & $72.\overline{72}\%$ & X & $9.\overline{09}\%$ \\ % total = 11
    \hline
    rumq & $25\%$ & $50\%$ & X & $25\%$ \\ % total = 4
    \hline
    rust-boomphf & $66.\overline{6}\%$ & $66.\overline{6}\%$ & X & $66.\overline{6}\%$ \\ % total = 3
     \hline
    rust-btoi & $55.\overline{5}\%$ & $77.\overline{7}\%$ & $77.\overline{7}\%$ & $88.\overline{8}\%$ \\ % total = 9
    \hline
    rust-obstack & $40\%$ & $60\%$ & X & $20\%$ \\ % total = 5
    \hline
    rust-url & X & X & X & X \\ % total = 1
    \hline
    simhash-rs & X & X & X & X \\ % total = 1
    \hline
    simple-irc-rs & - & - & X & $50\%$ \\ % total = 1
    \hline
    sliding\_puzzle\_rust & $61.54\%$ & $53.85\%$ & $84.62\%$ & $7.69\%$ \\ % total = 13
     \hline
    soa-derive & $20\%$ & X & $60\%$ & $50\%$ \\ % total = 10
    \hline
    sstable & - & $50\%$ & X & $50\%$ \\ % total = 2
     \hline
    ta-rs & $73.\overline{3}\%$ & $40\%$ & $26.\overline{6}\%$ & $46.\overline{6}\%$ \\ % total = 15
    \hline
    ticket & $33.\overline{3}\%$ & $33.\overline{3}\%$ & X & $66.\overline{6}\%$ \\ % total = 3
    \hline
    time-parse & $50\%$ & $50\%$ & $50\%$ & X \\ % total = 2
    \hline
    ucg & - & $53.85\%$ & X & $53.85\%$ \\ % total = 13
    \hline
    ulid-rs & $40\%$ & $40\%$ & $40\%$ & X \\ % total = 5
    \hline
    whatlang-rs & $50\%$ & X & X & $50\%$ \\ % total = 2
     \hline
    woodpecker & $54.84\%$ & $87.1\%$ & $90.32\%$ & $58.06\%$ \\ % total = 31
    \hline
    xoroshiro & $47.62\%$ & $42.86\%$ & $66.\overline{6}\%$ & $66.\overline{6}\%$ \\ % total = 21
    \hline
    xoshiro & X & X & X & - \\ % total = 1
    \hline
    zip-rs & X & - & - & X \\ % total = 1
    \hline
  \caption{Percent of benchmarks that line up with expectations \#1 and \#3 (X if 100\%, - if 0\%, otherwise explicit).}
  \label{table:formatting}
\end{longtable}

\begin{longtable}[h!]{|l|c|c|c|c|}
    \hline
    \textbf{Crate} & \textbf{\#2 [VANILLA]} & \textbf{\#2 [NOBC]} & \textbf{\#2 [NOBC+SL]} & \textbf{\#2 [SAFELIB]} \\
    \hline
    \hline
    KDFs & X & $66.\overline{6}\%$ & X & X \\ 
    \hline
    PAKEs & - & $50\%$ & $50\%$ & X \\
    \hline
    RustQIP & X & X & X & $90\%$ \\
    \hline
    arrayvec & $81.\overline{81}\%$ & $54.\overline{54}\%$ & $63.\overline{63}\%$ & $72.\overline{72}\%$ \\
    \hline
    average & $33.\overline{3}\%$ &  $33.\overline{3}\%$ & $50\%$ & $50\%$ \\
    \hline
    base-x-rs & $66.\overline{6}\%$ & $66.\overline{6}\%$ & $66.\overline{6}\%$ & $66.\overline{6}\%$ \\
    \hline
    bayesic\_rs & X & X & X & X \\
    \hline
    bdays & $66.\overline{6}\%$ & $66.\overline{6}\%$ & $66.\overline{6}\%$ & $66.\overline{6}\%$ \\
    \hline
    boyer-moore-magiclen & $58.\overline{3}\%$ & $45.8\overline{3}\%$ & $54.1\overline{6}\%$ & $58.\overline{3}\%$ \\ % total = 24
    \hline
    bravery\_router & $77.\overline{7}\%$ & $55.\overline{5}\%$ & X & X \\ % total = 9
    \hline
    bucket\_queue & $30\%$ & - & $50\%$ & $50\%$ \\ % total = 10
    \hline
    chess\_perft & $72.\overline{2}\%$ & $22.\overline{2}\%$ & $48.15\%$ & $18.52\%$ \\ % total = 54
    \hline
    coinaddress & - & X & X & X \\ % 1
    \hline
    color-thief-rs & X & - & - & X \\ % 2
    \hline
    crc-any & $40\%$ & $20\%$ & $40\%$ & $30\%$ \\ % 10
     \hline
    directories-rs & $75\%$ & X & X & X \\ % 4 
    \hline
    exrs & $23.08\%$ & - & X & X \\ % 13
    \hline
    fair-baccarat & - & - & X & - \\ % 1
    \hline
    fbleau & X & X & X & X \\ % 2
    \hline
    flatten-overlapping... & - & X & X & X \\ % 1
    \hline
    frappe & $90\%$ & $90\%$ & X & X \\ % 10
     \hline
    gift & X & - & - & X \\ % 1
    \hline
    horned-owl & X & X & X & X \\ % 4
    \hline
    implicit3d & $75\%$ & $81.25\%$ & $81.25\%$ & $81.25\%$ \\ % 16
    \hline
    ixlist & $85.71\%$ & $71.43\%$ & $71.43\%$ & $71.43\%$ \\ % 7
    \hline
    lazy-static-include & $66.\overline{6}\%$ & X & $33.\overline{3}\%$ & $77.\overline{7}\%$ \\ % 9
    \hline
    lebe & X & X & X & X \\ % 10
     \hline
    lehmer & $80\%$ & X & X & X \\ % 5
    \hline
    matrixmultiply & $12.5\%$ & $6.25\%$ & X & X \\ % 32
    \hline
    metric & - & - & - & - \\ % 4
    \hline
    nblast-rs & $88.\overline{8}\%$ & $88.\overline{8}\%$ & X & X \\ % 9 
    \hline
    optional & $48.42\%$ & $46.32\%$ & $47.37\%$ & $48.42\%$ \\ % 95
    \hline
    outils & $50\%$ & $25\%$ & $33.\overline{3}\%$ & $66.\overline{6}\%$ \\ % 12
     \hline
    partition & $90\%$ & $76.\overline{6}\%$ & $66.\overline{6}\%$ & $80\%$ \\ % 30
    \hline
    ripb & $90\%$ & $85\%$ & $95\%$ & $95\%$ \\ % 20
    \hline
    ropey & $77.92\%$ & $67.53\%$ & $92.21\%$ & $94.81\%$ \\ % 77
    \hline
    rtriangulate & $72.\overline{72}\%$ & - & $90.\overline{90}\%$ & X \\ % 11
    \hline
    rumq & $50\%$ & $75\%$ & X & X \\ % 4
    \hline
    rust-boomphf & $33.\overline{3}\%$ & $33.\overline{3}\%$ & X & X \\ % 3
     \hline
    rust-btoi & X & $88.\overline{8}\%$ & $88.\overline{8}\%$ & $88.\overline{8}\%$ \\ % 9 
    \hline
    rust-obstack & $60\%$ & $80\%$ & X & X \\ % 5
    \hline
    rust-url & - & - & - & - \\ % 1
    \hline
    simhash-rs & X & X & X & X \\ % 1
    \hline
    simple-irc-rs & $50\%$ & X & X & X \\ % 1
    \hline
    sliding\_puzzle\_rust & $92.31\%$ & $92.31\%$ & X & X \\ % 13
     \hline
    soa-derive & $60\%$ & $60\%$ & $70\%$ & $60\%$ \\ % 10
    \hline
    sstable & X & X & X & X \\ % 2
     \hline
    ta-rs & $60\%$ & $53.\overline{3}\%$ & $60\%$ & $60\%$ \\ % 15
    \hline
    ticket & X & $66.\overline{6}\%$ & X & X \\ % 3
    \hline
    time-parse & X & X & X & X \\ % 2
    \hline
    ucg & $69.23\%$ & $69.23\%$ & $84.62\%$ & $76.92\%$ \\ % 13
    \hline
    ulid-rs & X & $80\%$ & $60\%$ & X \\ % 5
    \hline
    whatlang-rs & X & X & X & X \\ % 2
     \hline
    woodpecker & $67.74\%$ & $87.1\%$ & $96.77\%$ & $93.55\%$ \\ % 31 ... 20
    \hline
    xoroshiro & $61.9\%$ & $66.\overline{6}\%$ & $71.43\%$ & $71.43\%$ \\ % 21
    \hline
    xoshiro & X & X & X & X \\ % 1
    \hline
    zip-rs & - & - & - & - \\ % 1
    \hline
  \caption{Percent of benchmarks that line up with expectation \#2, per rustc version (X if 100\%, - if 0\%, otherwise explicit).}
  \label{table:formatting2}
\end{longtable}



\section{Extrapolating the Expected Effects of Our Pass}





\end{document}